---
- include_tasks: variables.yml

# Install using NLSL2 deb packages
- name: Install EPICS using NSLS2 deb packages
  block:
    - name: Include repositories
      include_role:
        name: lnls-ans-role-repositories

    - include_tasks: setup-Debian.yml
  when:
    - ansible_os_family == 'Debian'
    - not epics_install_from_source

# Install EPICS from source
- include_tasks: install-from-source.yml
  when:
    - ansible_os_family != 'Debian' or epics_install_from_source

# Install EPICS environment variables
- name: Ensure EPICS environment is installed
  template:
    src: "{{ item.filename }}.j2"
    dest: "{{ item.pathname }}/{{ item.filename }}"
    owner: root
    group: root
    mode: 0644
  become: true
  with_items:
    - "{{ epics_config_files }}"

# Prepare the legacy python-sirius environment
- name: Install Legacy python-sirius environment
  block:
    - name: "Include role lnls-ans-role-python"
      include_role:
        name: lnls-ans-role-python

    - name: "Install epics related python packages into {{ pip_executable }} and {{ pip2_executable }}"
      include_tasks: install-python-packages.yml

  when:
    - epics_install_python_packages is defined
    - epics_install_python_packages is true
